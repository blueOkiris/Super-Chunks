// Updates whenever possible (to be fast)
function Update() {
	switch(game_state) {
	case GameState.Menu: // Click to start
		if(key[space])
			game_state = GameState.MenuToGame; // Wait for release
		break;
	
	case GameState.MenuToGame:
		if(!key[space]) {
			current_unlock = 0;
			changeLevel(intro_level, intro_level_music);
			game_state = GameState.Game;
		}
		break;
	
	case GameState.Game: // play the game
		movementPhysics();
		collisionChecks();
		enemyCollisions();
					 		
	 	if(key[esc] && game_canpause && !player.dead) {
	 		game_canpause = false;
	 		game_state = GameState.Paused;
	 		game_pause_msg[1] = "";
	 		game_pause_msg[2] = "";
	 		game_pause_msg[3] = "PAUSED";
	 		game_pause_msg[4] = "";
	 		game_pause_msg[5] = "";
	 	}
		break;
		
	case GameState.GameOver:
		if(space_released) {
			bg_music[0].duration = 0;
			game_state = GameState.Menu; // Wait for release
		}
		break;
	
	case GameState.Paused:
		if(key[esc] && game_canpause) {
			game_canpause = false;
			game_state = GameState.Game;
		}
		break;
	
	case GameState.Popup:
		if(key[enter] && game_popup) {
			game_popup = false;
			game_state = GameState.Game;
		}
		break;
	}
}

/*function changeLevel(levelData, backgroundColor, newEnemies, startLocation) {
	player = new Player(startLocation[0], startLocation[1], 1, 4, 10, 0.4, 11, 46, 50, 0);
	current_level = levelData;
	enemies = newEnemies;
	current_level_bg = backgroundColor;
	player.saveUnlock();
}*/

function changeLevel(new_level, newMusic) {
	player = new Player(startLocation[0], startLocation[1], 1, 4, 10, 0.4, 11, 46, 50, 0);
	current_level = new_level;
	player.saveUnlock();
	
	if(newMusic != -1) {
		bg_music[curr_lev_music].pause();
		bg_music[curr_lev_music].duration = 0;
		curr_lev_music = newMusic;
		bg_music[curr_lev_music].play();
	}
}

